# Как добавить реальную оплату Boneka Client

## Что нужно, чтобы я могла подключить оплату на сайте

Чтобы автоматически подключить приём платежей на сайте, нужны следующие данные (в зависимости от выбранной кассы):

**Если ЮKassa (рекомендуется):**
- `shopId` — идентификатор магазина (из личного кабинета ЮKassa).
- Секретный ключ (Secret Key) — для создания платежей и проверки webhook.
- Доступ к размещению бэкенда: либо URL вашего сервера (Node.js / PHP / Python), куда можно добавить два endpoint’а (создание платежа + webhook), либо возможность создать их по вашей инструкции.

**Если Robokassa:**
- Логин магазина (MerchantLogin).
- Пароль #1 и пароль #2 (для Result URL и Success URL).
- То же по бэкенду: два endpoint’а на вашем сервере или инструкция, где их развернуть.

**Общее:**
- Бэкенд обязателен: приём денег нельзя безопасно делать только в браузере. Нужен сервер с двумя страницами/скриптами: «создать платёж» (возвращает ссылку на оплату) и «webhook» (принимает уведомление от кассы и выдаёт подписку пользователю).
- После того как вы пришлёте ключи и решите, где будет работать бэкенд (хостинг, VPS, сервис вроде Vercel + serverless), можно будет прописать вызовы с `payment.html` и логику выдачи подписки.

---

Сейчас на сайте используется **демо-оплата**: кнопка «Подтвердить оплату» просто записывает подписку в `localStorage` и перенаправляет в кабинет. Чтобы принимать деньги по-настоящему, нужно подключить платёжный провайдер и вызывать его со страницы оплаты.

## Варианты для РФ

1. **ЮKassa (бывш. Яндекс.Касса)**  
   - Сайт: https://yookassa.ru  
   - Документация: https://yookassa.ru/developers  
   - Поддерживает: карты, СБП, кошелёк ЮMoney и др.  
   - Нужен: аккаунт продавца, `shopId` и секретный ключ.

2. **Robokassa**  
   - Сайт: https://robokassa.ru  
   - Поддерживает: карты, СБП, Qiwi, крипто и др.  
   - Нужен: логин магазина, пароли #1 и #2 (для Result URL и Success URL).

3. **FreeKassa**  
   - Сайт: https://freekassa.ru  
   - Аналогичная схема: регистрация магазина, получение ключей, приём оплаты через форму или API.

## Общая схема

1. **Бэкенд (обязательно)**  
   Реальную приёмку платежей нельзя безопасно делать только в браузере. Нужен свой сервер (Node.js, PHP, Python и т.д.), который:
   - Принимает запрос «создать платёж» от вашего сайта (после нажатия «Оплатить»).
   - Генерирует платёж в выбранной системе (ЮKassa/Robokassa/др.) и возвращает клиенту ссылку на оплату или данные для редиректа.
   - Принимает webhook (callback) от платёжной системы о успешной оплате и обновляет подписку пользователя в вашей базе (или выдаёт ключ/лицензию).

2. **На сайте (frontend)**  
   - На странице `payment.html` вместо прямой записи в `localStorage`:
     - Отправлять запрос на ваш бэкенд: «создать платёж для пользователя X, план Y».
     - Бэкенд возвращает URL оплаты (или форму) → перенаправлять пользователя туда.
   - После оплаты платёжная система перенаправляет пользователя на ваш URL (например `https://yoursite.com/payment-success.html?orderId=...`).  
   - На `payment-success` можно:
     - Отправить запрос на бэкенд «проверить заказ orderId и выдать подписку», затем редирект в кабинет.
     - Или подождать webhook: бэкенд уже обновил подписку, а страница просто показывает «Оплата прошла» и кнопку «В личный кабинет».

3. **Проверка подписки**  
   Сейчас подписка хранится в `localStorage` (ключи `boneka_users`, у каждого пользователя поле `plan`). В реальной схеме:
   - Либо бэкенд при каждом заходе в кабинет отдаёт актуальный статус подписки (по сессии или токену).
   - Либо после логина фронт запрашивает у бэкенда «мой план» и сохраняет в `localStorage` / отображает в кабинете и разрешает/запрещает скачивание лаунчера.

## Минимальные шаги

1. Зарегистрироваться в ЮKassa (или Robokassa) и получить ключи.
2. Написать бэкенд: один endpoint «создать платёж» (возвращает redirect URL), второй — «webhook» от кассы (обновляет подписку в БД по `orderId`/внешнему id).
3. В базе хранить: email (или userId), план (1m / 3m / forever / alpha), дата окончания (для 1m/3m) или флаг «навсегда/alpha».
4. На `payment.html` заменить демо-логику на вызов вашего API и редирект на оплату.
5. Добавить страницу успешной оплаты и (по желанию) неуспешной.

После этого оплата будет производиться на сайте через выбранную платёжную систему, а не в Telegram.
